<html>
<head>
  <title>TensorflowJS Image Classification</title>
</head>
<body>
  <h1>TensorflowJS Image Classification</h1>

  <!-- Load the TensorflowJS library -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>

  <!-- Load the model from the local folder -->
  <script>
    const modelUrl = './diceReaderModeltfjs_reduced/model.json';
    let model;

    async function loadModel() {
      model = await tf.loadLayersModel(modelUrl);
    }

    loadModel();
  </script>

  <!-- Display a video element to show the camera feed -->
  <video id="camera-feed" autoplay></video>

  <!-- Display the classification output -->
  <div id="classification-output">
    <p>Classification: <span id="classification-label"></span></p>
  </div>

  <!-- Style the classification label -->
  <style>
    #classification-label {
      font-size: 48px;
    }
  </style>

  <!-- Run the classification on the camera feed -->
  <script>
    const labels = ['0', '1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '3', '30', '4', '40', '5', '50', '6', '60', '7', '70', '8', '80', '9', '90'];

    // Get the video element and the classification label
    const video = document.getElementById('camera-feed');
    const output = document.getElementById('classification-label');

    // Get the user's camera and start the video feed
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;

        // Start the classification when the video has loaded
        video.addEventListener('loadeddata', classifyVideo);
      });

    // Function to classify the current frame of the video
    async function classifyVideo() {
      // Wait for the model to be loaded before continuing
      await loadModel();

      // Preprocess the image for the model
      const image = await tf.browser.fromPixels(video);
      const resizedImage = tf.image.resizeBilinear(image, [224, 224]);
      const normalizedImage = tf.div(tf.sub(resizedImage, 127.5), 127.5);

      // Run the classification on the image
      const predictions = await model.predict(normalizedImage.expandDims());
      const predictedIndex = predictions.argMax(1).dataSync()[0];

      // Find the label that corresponds to the predicted index
      const label = labels.find((label, index) => index === predictedIndex);

      // Display the classification output
      output.innerHTML = label;

      // Continue to classify the video feed in a loop
      setTimeout(classifyVideo, 1000);
    }
  </
